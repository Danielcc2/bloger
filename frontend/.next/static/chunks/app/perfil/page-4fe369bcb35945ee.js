(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[921],{5695:(e,r,t)=>{"use strict";var a=t(8999);t.o(a,"useParams")&&t.d(r,{useParams:function(){return a.useParams}}),t.o(a,"usePathname")&&t.d(r,{usePathname:function(){return a.usePathname}}),t.o(a,"useRouter")&&t.d(r,{useRouter:function(){return a.useRouter}})},5731:(e,r,t)=>{"use strict";t.d(r,{A:()=>l,default:()=>i});var a=t(5155),s=t(2115),o=t(5695);let n=(0,s.createContext)(void 0),l=()=>{let e=(0,s.useContext)(n);if(void 0===e)throw Error("useAuth debe ser usado dentro de un AuthProvider");return e};function i(e){let{children:r}=e,[t,l]=(0,s.useState)(null),[i,c]=(0,s.useState)(null),[u,d]=(0,s.useState)(!0),[m,h]=(0,s.useState)(null),f=(0,o.useRouter)();(0,s.useEffect)(()=>{(async()=>{try{let e=localStorage.getItem("token");if(e){c(e);let r=await fetch("http://localhost:8000/api/users/profile/",{headers:{Authorization:"Bearer ".concat(e)}});if(r.ok){let e=await r.json();l(e)}else localStorage.removeItem("token"),c(null),l(null)}}catch(e){console.error("Error verificando sesi\xf3n:",e)}finally{d(!1)}})()},[]);let g=async(e,r)=>{d(!0),h(null);try{let t=await fetch("http://localhost:8000/api/token/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:r})});if(t.ok){let e=await t.json();localStorage.setItem("token",e.access),localStorage.setItem("refresh_token",e.refresh),c(e.access);let r=await fetch("http://localhost:8000/api/users/profile/",{headers:{Authorization:"Bearer ".concat(e.access)}});if(r.ok){let e=await r.json();return l(e),!0}}else{let e=await t.json();return h(e.detail||"Error al iniciar sesi\xf3n"),!1}}catch(e){h("Error de conexi\xf3n"),console.error(e)}finally{d(!1)}return!1},p=async(e,r,t,a)=>{d(!0),h(null);try{let n={email:e,password:r,...t&&{first_name:t},...a&&{last_name:a}},l=await fetch("http://localhost:8000/api/users/register/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(l.ok)return await g(e,r);{var s,o;let e=await l.json();return h((null==(s=e.email)?void 0:s[0])||(null==(o=e.password)?void 0:o[0])||"Error al registrarse"),!1}}catch(e){return h("Error de conexi\xf3n"),console.error(e),!1}finally{d(!1)}};return(0,a.jsx)(n.Provider,{value:{user:t,token:i,login:g,register:p,logout:()=>{localStorage.removeItem("token"),localStorage.removeItem("refresh_token"),c(null),l(null),f.push("/")},isAuthenticated:!!t&&!!i,isLoading:u,error:m},children:r})}},7860:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>l});var a=t(5155),s=t(2115),o=t(5695),n=t(5731);function l(){var e;let{user:r,isLoading:t}=(0,n.A)(),l=(0,o.useRouter)(),[i,c]=(0,s.useState)(null),[u,d]=(0,s.useState)(!0),[m,h]=(0,s.useState)(null),[f,g]=(0,s.useState)([]),[p,x]=(0,s.useState)([]),[b,j]=(0,s.useState)(!1),[v,y]=(0,s.useState)("");(0,s.useEffect)(()=>{t||r||l.push("/login")},[t,r,l]),(0,s.useEffect)(()=>{(async()=>{if(r)try{var e;d(!0);let r=localStorage.getItem("token"),t=await fetch("http://localhost:8000/api/users/interests/",{headers:{Authorization:"Bearer ".concat(r)}});if(!t.ok)throw console.error("Error perfil:",t.status),Error("Error al cargar el perfil: ".concat(t.status));let a=await t.json();c(a),x((null==(e=a.interests)?void 0:e.map(e=>e.id))||[]);try{let e=await fetch("http://localhost:8000/api/tags/",{headers:{Authorization:"Bearer ".concat(r)}});if(e.ok){let r=await e.json();g(r.results||[])}else console.error("Error tags:",e.status),a.interests&&a.interests.length>0&&g(a.interests)}catch(e){console.error("Error obteniendo tags:",e),a.interests&&a.interests.length>0&&g(a.interests)}h(null)}catch(e){console.error("Error cargando perfil:",e),h("Error al cargar el perfil. Por favor, int\xe9ntalo de nuevo m\xe1s tarde.")}finally{d(!1)}})()},[r]);let N=e=>{x(r=>r.includes(e)?r.filter(r=>r!==e):[...r,e])},w=async()=>{try{j(!0),y(""),h(null);let e=localStorage.getItem("token");if(!e)throw Error("No est\xe1s autenticado");console.log("Enviando intereses:",{interest_ids:p});let r=await fetch("http://localhost:8000/api/users/interests/",{method:"PATCH",headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"},body:JSON.stringify({interest_ids:p})});if(!r.ok){let e=await r.text();throw console.error("Error respuesta:",r.status,e),Error("Error al actualizar intereses: ".concat(r.status))}let t=await r.json();c(t),y("\xa1Tus intereses se han actualizado correctamente!"),setTimeout(()=>{y("")},3e3)}catch(e){console.error("Error guardando intereses:",e),h("Error al actualizar intereses. ".concat(e instanceof Error?e.message:"Int\xe9ntalo de nuevo."))}finally{j(!1)}},E=f.length>0?f:[{id:1,name:"Playas",slug:"playas"},{id:2,name:"Monta\xf1as",slug:"montanas"},{id:3,name:"Ciudades",slug:"ciudades"},{id:4,name:"Gastronom\xeda",slug:"gastronomia"},{id:5,name:"Mochileros",slug:"mochileros"},{id:6,name:"Familiar",slug:"familiar"},{id:7,name:"Ecoturismo",slug:"ecoturismo"},{id:8,name:"Cultural",slug:"cultural"},{id:9,name:"Aventura",slug:"aventura"},{id:10,name:"Lujo",slug:"lujo"},{id:11,name:"Presupuesto",slug:"presupuesto"},{id:12,name:"Europa",slug:"europa"},{id:13,name:"Asia",slug:"asia"},{id:14,name:"Am\xe9rica",slug:"america"},{id:15,name:"\xc1frica",slug:"africa"},{id:16,name:"Ocean\xeda",slug:"oceania"}];return t||u?(0,a.jsx)("div",{className:"flex justify-center items-center min-h-screen",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-teal-500"})}):r?(0,a.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,a.jsx)("div",{className:"max-w-3xl mx-auto",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6 mb-6",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold mb-6",children:"Tu Perfil"}),(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-2",children:"Informaci\xf3n b\xe1sica"}),(0,a.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg",children:[(0,a.jsxs)("p",{className:"mb-2",children:[(0,a.jsx)("span",{className:"font-medium",children:"Email:"})," ",r.email]}),(0,a.jsxs)("p",{className:"mb-2",children:[(0,a.jsx)("span",{className:"font-medium",children:"Nombre:"})," ",r.first_name||r.full_name||"No disponible"]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("span",{className:"font-medium",children:"Miembro desde:"})," ",(e=>{if(!e)return"No disponible";try{return new Date(e).toLocaleDateString("es-ES",{day:"numeric",month:"long",year:"numeric"})}catch(e){return console.error("Error formateando fecha:",e),"Fecha inv\xe1lida"}})((null==i||null==(e=i.user)?void 0:e.date_joined)||r.date_joined)]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Tus intereses de viaje"}),(0,a.jsx)("p",{className:"text-gray-600 mb-4",children:"Selecciona los temas que m\xe1s te interesan para recibir por correo electr\xf3nico informaci\xf3n personalizada sobre destinos y ofertas relacionadas."}),m&&!u&&(0,a.jsx)("div",{className:"bg-red-50 border border-red-400 text-red-700 px-4 py-3 rounded mb-4",children:m}),v&&(0,a.jsx)("div",{className:"bg-green-50 border border-green-400 text-green-700 px-4 py-3 rounded mb-4",children:v}),(0,a.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-3 mb-6",children:E.map(e=>(0,a.jsx)("div",{onClick:()=>N(e.id),className:"\n                    p-3 rounded-lg cursor-pointer transition-colors border\n                    ".concat(p.includes(e.id)?"bg-teal-100 border-teal-500 text-teal-900":"bg-white border-gray-200 hover:bg-gray-50 text-gray-800","\n                  "),children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("input",{type:"checkbox",checked:p.includes(e.id),onChange:()=>{},className:"h-4 w-4 text-teal-600 rounded focus:ring-teal-500 mr-2"}),(0,a.jsx)("span",{children:e.name})]})},e.id))}),(0,a.jsx)("div",{className:"flex justify-end",children:(0,a.jsx)("button",{onClick:w,disabled:b,className:"\n                  px-4 py-2 bg-teal-600 text-white rounded-lg hover:bg-teal-700\n                  transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-teal-500\n                  ".concat(b?"opacity-70 cursor-not-allowed":"","\n                "),children:b?"Guardando...":"Guardar intereses"})})]})]})})}):null}},8223:(e,r,t)=>{Promise.resolve().then(t.bind(t,7860))}},e=>{var r=r=>e(e.s=r);e.O(0,[441,684,358],()=>r(8223)),_N_E=e.O()}]);