(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[849],{4539:(e,t,r)=>{Promise.resolve().then(r.bind(r,9144))},5695:(e,t,r)=>{"use strict";var a=r(8999);r.o(a,"useParams")&&r.d(t,{useParams:function(){return a.useParams}}),r.o(a,"usePathname")&&r.d(t,{usePathname:function(){return a.usePathname}}),r.o(a,"useRouter")&&r.d(t,{useRouter:function(){return a.useRouter}})},5731:(e,t,r)=>{"use strict";r.d(t,{A:()=>i,default:()=>n});var a=r(5155),o=r(2115),l=r(5695);let s=(0,o.createContext)(void 0),i=()=>{let e=(0,o.useContext)(s);if(void 0===e)throw Error("useAuth debe ser usado dentro de un AuthProvider");return e};function n(e){let{children:t}=e,[r,i]=(0,o.useState)(null),[n,c]=(0,o.useState)(null),[d,u]=(0,o.useState)(!0),[h,m]=(0,o.useState)(null),p=(0,l.useRouter)();(0,o.useEffect)(()=>{(async()=>{try{let e=localStorage.getItem("token");if(e){c(e);let t=await fetch("http://localhost:8000/api/users/profile/",{headers:{Authorization:"Bearer ".concat(e)}});if(t.ok){let e=await t.json();i(e)}else localStorage.removeItem("token"),c(null),i(null)}}catch(e){console.error("Error verificando sesi\xf3n:",e)}finally{u(!1)}})()},[]);let x=async(e,t)=>{u(!0),m(null);try{let r=await fetch("http://localhost:8000/api/token/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t})});if(r.ok){let e=await r.json();localStorage.setItem("token",e.access),localStorage.setItem("refresh_token",e.refresh),c(e.access);let t=await fetch("http://localhost:8000/api/users/profile/",{headers:{Authorization:"Bearer ".concat(e.access)}});if(t.ok){let e=await t.json();return i(e),!0}}else{let e=await r.json();return m(e.detail||"Error al iniciar sesi\xf3n"),!1}}catch(e){m("Error de conexi\xf3n"),console.error(e)}finally{u(!1)}return!1},g=async(e,t,r,a)=>{u(!0),m(null);try{let s={email:e,password:t,...r&&{first_name:r},...a&&{last_name:a}},i=await fetch("http://localhost:8000/api/users/register/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(i.ok)return await x(e,t);{var o,l;let e=await i.json();return m((null==(o=e.email)?void 0:o[0])||(null==(l=e.password)?void 0:l[0])||"Error al registrarse"),!1}}catch(e){return m("Error de conexi\xf3n"),console.error(e),!1}finally{u(!1)}};return(0,a.jsx)(s.Provider,{value:{user:r,token:n,login:x,register:g,logout:()=>{localStorage.removeItem("token"),localStorage.removeItem("refresh_token"),c(null),i(null),p.push("/")},isAuthenticated:!!r&&!!n,isLoading:d,error:h},children:t})}},9144:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>d});var a=r(5155),o=r(2115),l=r(6766),s=r(6874),i=r.n(s),n=r(5695),c=r(5731);function d(){var e,t;let r=(0,n.useParams)(),s=(0,n.useRouter)(),{user:d,token:u}=(0,c.A)(),[h,m]=(0,o.useState)(null),[p,x]=(0,o.useState)([]),[g,f]=(0,o.useState)(!0),[v,y]=(0,o.useState)(null),[j,w]=(0,o.useState)(0),[b,N]=(0,o.useState)(""),[S,E]=(0,o.useState)(!1),[k,z]=(0,o.useState)(!1),[R,C]=(0,o.useState)(!1),_=Array.isArray(null==r?void 0:r.slug)?r.slug[0]:null==r?void 0:r.slug;(0,o.useEffect)(()=>{C(!0),(async()=>{if(d&&u)try{console.log("Verificando si el usuario es administrador..."),console.log("Usuario actual:",d);let e=await fetch("http://localhost:8000/api/users/permissions/",{headers:{Authorization:"Bearer ".concat(u)}});if(console.log("Respuesta de permisos:",e.status),e.ok){let t=await e.json();console.log("Datos de permisos:",t),console.log("\xbfEs admin seg\xfan la API?",t.is_admin)}}catch(e){console.error("Error verificando permisos de administrador:",e)}})()},[d,u]),(0,o.useEffect)(()=>{(async()=>{if(_)try{f(!0);let e=await fetch("http://localhost:8000/api/articles/".concat(_,"/"));if(!e.ok)throw Error("Error al cargar el art\xedculo: ".concat(e.status));let t=await e.json();m(t);let r=await fetch("http://localhost:8000/api/articles/".concat(_,"/comments/"));if(r.ok){let e=await r.json();x(e.results||[])}}catch(e){console.error("Error:",e),y("Error al cargar el art\xedculo. Por favor, int\xe9ntalo de nuevo m\xe1s tarde.")}finally{f(!1)}})()},[_]);let A=e=>new Date(e).toLocaleDateString("es-ES",{day:"numeric",month:"long",year:"numeric"}),P=async e=>{if(!d)return void s.push("/login");try{z(!0);let t=localStorage.getItem("token");if(!t){console.error("No se encontr\xf3 token de autenticaci\xf3n"),y("Por favor, inicia sesi\xf3n nuevamente para valorar");return}console.log("Enviando valoraci\xf3n a:","http://localhost:8000/api/articles/".concat(_,"/rate/")),console.log("Valoraci\xf3n:",e);let r=await fetch("http://localhost:8000/api/articles/".concat(_,"/rate/"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)},body:JSON.stringify({score:e})});console.log("Respuesta del servidor (valoraci\xf3n):",r.status,r.statusText);let a="Error al enviar valoraci\xf3n";try{let t=await r.text();if(console.log("Respuesta de valoraci\xf3n en texto:",t),!r.ok){if(t.trim().startsWith("{")||t.trim().startsWith("["))try{let e=JSON.parse(t);console.error("Detalles del error:",e),a=e.detail||e.message||e.error||a}catch(e){console.error("Error al analizar respuesta JSON:",e)}throw y(a),Error(a)}let o=await fetch("http://localhost:8000/api/articles/".concat(_,"/"));if(o.ok){let e=await o.json();m(e)}w(e),y(null)}catch(e){throw console.error("Error al procesar la respuesta:",e),y(a),Error(a)}}catch(e){console.error("Error:",e),v||y("Error al enviar la valoraci\xf3n. Por favor, intenta de nuevo.")}finally{z(!1)}},I=async e=>{if(e.preventDefault(),!d)return void s.push("/login");if(b.trim())try{E(!0);let e=localStorage.getItem("token");if(!e){console.error("No se encontr\xf3 token de autenticaci\xf3n"),y("Por favor, inicia sesi\xf3n nuevamente para comentar");return}console.log("Enviando comentario a:","http://localhost:8000/api/articles/".concat(_,"/comments/create/")),console.log("Contenido del comentario:",b);let t=await fetch("http://localhost:8000/api/articles/".concat(_,"/comments/create/"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)},body:JSON.stringify({content:b})});console.log("Respuesta del servidor:",t.status,t.statusText);let r="Error al enviar comentario";try{let e,a=await t.text();if(console.log("Respuesta en texto:",a),!t.ok){if(a.trim().startsWith("{")||a.trim().startsWith("["))try{let e=JSON.parse(a);console.error("Detalles del error:",e),r=e.detail||e.message||e.error||r}catch(e){console.error("Error al analizar respuesta JSON:",e)}else console.error("Respuesta no es JSON v\xe1lido:",a);throw y(r),Error(r)}try{e=JSON.parse(a),console.log("Comentario creado:",e)}catch(e){console.error("Error al analizar respuesta JSON del comentario:",e),y("El comentario se envi\xf3 pero hubo un error al procesar la respuesta");return}x(t=>[e,...t]),N(""),y(null)}catch(e){throw console.error("Error al procesar la respuesta del comentario:",e),y(r),Error(r)}}catch(e){console.error("Error al enviar comentario:",e),v||y("Error al enviar el comentario. Por favor, intenta de nuevo.")}finally{E(!1)}},O=(null==h?void 0:h.image)?h.image.startsWith("http")?h.image:h.image.startsWith("/media/")?"http://localhost:8000".concat(h.image):"http://localhost:8000/media/".concat(h.image):null;return g?(0,a.jsx)("div",{className:"flex justify-center items-center min-h-screen",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-teal-500"})}):v||!h?(0,a.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,a.jsxs)("div",{className:"max-w-4xl mx-auto bg-red-50 p-6 rounded-lg",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-red-700 mb-4",children:"Error"}),(0,a.jsx)("p",{className:"text-gray-700 mb-4",children:v||"No se encontr\xf3 el art\xedculo solicitado"}),(0,a.jsx)(i(),{href:"/articulos",className:"inline-block px-6 py-2 bg-teal-600 text-white rounded-lg hover:bg-teal-700 transition-colors",children:"Volver a art\xedculos"})]})}):(0,a.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,a.jsxs)("div",{className:"max-w-4xl mx-auto",children:[v&&(0,a.jsx)("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg text-red-700",children:(0,a.jsxs)("p",{className:"flex items-center",children:[(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-2",viewBox:"0 0 20 20",fill:"currentColor",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),v]})}),(0,a.jsxs)("div",{className:"mb-8",children:[(0,a.jsxs)(i(),{href:"/articulos",className:"inline-flex items-center text-teal-600 hover:text-teal-800",children:[(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-1",viewBox:"0 0 20 20",fill:"currentColor",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M9.707 14.707a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 1.414L7.414 9H15a1 1 0 110 2H7.414l2.293 2.293a1 1 0 010 1.414z",clipRule:"evenodd"})}),"Volver a art\xedculos"]}),(0,a.jsxs)("div",{className:"my-4 p-2 bg-gray-100 text-xs rounded-lg",children:[(0,a.jsxs)("p",{children:["\xbfUsuario logueado?: ",d?"S\xed":"No"]}),d&&(0,a.jsxs)("p",{children:["ID de usuario: ",d.id]}),d&&(0,a.jsxs)("p",{children:["\xbfEs admin?: ",R?"S\xed":"No"," (Forzado a S\xed para depuraci\xf3n)"]}),h&&(0,a.jsxs)("p",{children:["ID del autor: ",h.author.id]}),(0,a.jsx)("p",{children:"\xbfDeber\xeda mostrar bot\xf3n de eliminar?: S\xed (siempre visible)"})]}),d&&(0,a.jsxs)(i(),{href:"/articulos/".concat(h.slug,"/editar-imagenes"),className:"inline-flex items-center text-teal-600 hover:text-teal-800 ml-2",children:[(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-1",viewBox:"0 0 20 20",fill:"currentColor",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z",clipRule:"evenodd"})}),"Gestionar im\xe1genes"]})]}),(0,a.jsx)("div",{className:"my-6",children:(0,a.jsxs)("button",{onClick:async()=>{if(window.confirm("\xbfEst\xe1s seguro de que quieres eliminar este art\xedculo? Esta acci\xf3n no se puede deshacer."))try{let e=localStorage.getItem("token");if(!e)return void s.push("/login");if((await fetch("http://localhost:8000/api/articles/".concat(h.slug,"/delete/"),{method:"DELETE",headers:{Authorization:"Bearer ".concat(e)}})).ok)s.push("/articulos");else throw Error("No se pudo eliminar el art\xedculo")}catch(e){console.error("Error al eliminar:",e),y("Error al eliminar el art\xedculo. Por favor, int\xe9ntalo de nuevo.")}},className:"px-6 py-3 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors font-bold text-lg shadow-md flex items-center",children:[(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-2",viewBox:"0 0 20 20",fill:"currentColor",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z",clipRule:"evenodd"})}),"ELIMINAR ESTE ART\xcdCULO"]})}),(0,a.jsxs)("div",{className:"mb-8",style:{backgroundColor:"#f8fafc",padding:"2rem",borderRadius:"1rem",boxShadow:"0 4px 6px rgba(0, 0, 0, 0.05)"},children:[(0,a.jsx)("h1",{className:"mb-4",style:{fontSize:"2.5rem",fontWeight:"bold",color:"#1a202c",fontFamily:"Helvetica Neue, Arial, sans-serif"},children:h.title}),(0,a.jsxs)("div",{className:"flex flex-wrap items-center gap-4 mb-6",children:[(0,a.jsx)("div",{style:{width:"3rem",height:"3rem",borderRadius:"50%",backgroundColor:"#0d9488",display:"flex",alignItems:"center",justifyContent:"center",color:"white",fontWeight:"bold",fontSize:"1.25rem"},children:(null==(e=h.author.first_name)?void 0:e.charAt(0).toUpperCase())||h.author.email.charAt(0).toUpperCase()}),(0,a.jsxs)("div",{style:{display:"flex",flexDirection:"column"},children:[(0,a.jsx)("span",{style:{fontSize:"1.125rem",fontWeight:"500"},children:h.author.first_name||h.author.email.split("@")[0]}),(0,a.jsx)("span",{style:{fontSize:"0.875rem",color:"#64748b"},children:A(h.created_at)})]}),(0,a.jsxs)("div",{style:{backgroundColor:"#e2e8f0",padding:"0.5rem 1rem",borderRadius:"9999px",display:"flex",alignItems:"center",fontSize:"0.875rem",color:"#475569"},children:[(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",style:{width:"1rem",height:"1rem",marginRight:"0.25rem"},viewBox:"0 0 20 20",fill:"currentColor",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z",clipRule:"evenodd"})}),Math.ceil(h.content.replace(/<[^>]*>/g,"").split(/\s+/).length/200)," min de lectura"]}),h.created_at!==h.updated_at&&(0,a.jsxs)("div",{style:{fontSize:"0.875rem",fontStyle:"italic",color:"#64748b"},children:["Actualizado: ",A(h.updated_at)]})]}),(0,a.jsx)("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem",marginBottom:"1rem"},children:h.tags.map(e=>(0,a.jsx)(i(),{href:"/categorias/".concat(e.slug),style:{backgroundColor:"#e6fffa",color:"#0d9488",padding:"0.5rem 1rem",borderRadius:"9999px",fontSize:"0.875rem",textDecoration:"none",transition:"all 0.2s",fontWeight:"500"},children:e.name},e.id))})]}),O&&(0,a.jsxs)("div",{style:{marginBottom:"2.5rem",borderRadius:"1rem",overflow:"hidden",position:"relative",boxShadow:"0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05)"},children:[(0,a.jsx)("div",{style:{position:"relative",height:"500px"},children:(0,a.jsx)(l.default,{src:O,alt:h.title,fill:!0,sizes:"(max-width: 768px) 100vw, (max-width: 1200px) 100vw, 800px",style:{objectFit:"cover",borderRadius:"1rem"},priority:!0,onError:e=>{let t=e.target;t.onerror=null,t.style.display="none"}})}),(0,a.jsxs)("div",{style:{position:"absolute",bottom:0,left:0,right:0,background:"linear-gradient(to top, rgba(0,0,0,0.8) 0%, transparent 100%)",padding:"1.5rem",color:"white"},children:[(0,a.jsx)("div",{style:{fontSize:"0.875rem",fontWeight:"500",marginBottom:"0.25rem"},children:"Destino destacado"}),(0,a.jsx)("div",{style:{fontSize:"1.5rem",fontWeight:"bold"},children:h.title})]})]}),(0,a.jsx)("div",{className:"prose lg:prose-xl max-w-none article-content",style:{fontFamily:"Georgia, serif",lineHeight:1.8,color:"#2d3748",fontSize:"1.125rem"},children:(0,a.jsx)("div",{dangerouslySetInnerHTML:{__html:h.content.replace(/<!--[\s\S]*?-->/g,"").replace(/children: "Información de depuración"/g,"").replace(/data-[a-zA-Z0-9-]*="[^"]*"/g,"")}})}),(0,a.jsxs)("div",{className:"bg-gray-50 p-6 rounded-lg mb-8",children:[(0,a.jsx)("h3",{className:"text-xl font-bold mb-4 text-gray-800",children:"\xbfTe ha gustado este art\xedculo?"}),(0,a.jsx)("div",{className:"flex items-center gap-2 mb-2",children:[1,2,3,4,5].map(e=>(0,a.jsx)("button",{onClick:()=>P(e),disabled:k,className:"text-3xl focus:outline-none transition-colors ".concat((j||0)>=e?"text-yellow-500":"text-gray-300 hover:text-yellow-300"),children:"★"},e))}),(0,a.jsx)("div",{className:"text-gray-600",children:h.ratings_count>0?(0,a.jsxs)("p",{children:["Valoraci\xf3n media: ",null==(t=h.avg_rating)?void 0:t.toFixed(1)," de 5 (",h.ratings_count," ",1===h.ratings_count?"valoraci\xf3n":"valoraciones",")"]}):(0,a.jsx)("p",{children:"S\xe9 el primero en valorar este art\xedculo"})})]}),(0,a.jsxs)("div",{className:"mb-8",children:[(0,a.jsx)("h3",{className:"text-2xl font-bold mb-6 text-gray-800",children:"Comentarios"}),d?(0,a.jsxs)("form",{onSubmit:I,className:"mb-8",children:[(0,a.jsx)("div",{className:"mb-4",children:(0,a.jsx)("textarea",{value:b,onChange:e=>N(e.target.value),placeholder:"Deja tu comentario...",className:"w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500",rows:4,required:!0})}),v&&(0,a.jsx)("div",{className:"mb-4 p-3 bg-red-50 text-red-700 rounded-lg",children:v}),(0,a.jsx)("button",{type:"submit",disabled:S||!b.trim(),className:"px-6 py-2 bg-teal-600 text-white rounded-lg hover:bg-teal-700 transition-colors disabled:opacity-50",children:S?"Enviando...":"Enviar comentario"})]}):(0,a.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg mb-8 text-center",children:[(0,a.jsx)("p",{className:"text-gray-700 mb-2",children:"Para dejar un comentario, necesitas iniciar sesi\xf3n"}),(0,a.jsx)(i(),{href:"/login",className:"inline-block px-4 py-2 bg-teal-600 text-white rounded-lg hover:bg-teal-700 transition-colors",children:"Iniciar sesi\xf3n"})]}),p.length>0?(0,a.jsx)("div",{className:"space-y-6",children:p.map(e=>(0,a.jsxs)("div",{className:"bg-white p-4 rounded-lg shadow",children:[(0,a.jsxs)("div",{className:"flex justify-between mb-2",children:[(0,a.jsx)("span",{className:"font-medium",children:e.user.first_name||e.user.email.split("@")[0]}),(0,a.jsx)("span",{className:"text-gray-500 text-sm",children:A(e.created_at)})]}),(0,a.jsx)("p",{className:"text-gray-700",children:e.content})]},e.id))}):(0,a.jsx)("div",{className:"text-center py-8 bg-gray-50 rounded-lg",children:(0,a.jsx)("p",{className:"text-gray-700",children:"No hay comentarios a\xfan. \xa1S\xe9 el primero en comentar!"})})]})]})})}}},e=>{var t=t=>e(e.s=t);e.O(0,[874,766,441,684,358],()=>t(4539)),_N_E=e.O()}]);