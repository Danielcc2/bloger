(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[569],{1284:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>d});var r=a(5155),l=a(2115),s=a(5695),i=a(5731),o=a(6766),n=a(6874),c=a.n(n);function d(){let{slug:e}=(0,s.useParams)(),t=(0,s.useRouter)(),{user:a,isAuthenticated:n}=(0,i.A)(),[d,u]=(0,l.useState)(null),[m,h]=(0,l.useState)([]),[g,p]=(0,l.useState)(!0),[f,x]=(0,l.useState)(null),[b,v]=(0,l.useState)(null),[j,w]=(0,l.useState)(null),[y,N]=(0,l.useState)(""),[E,S]=(0,l.useState)(!1),[k,I]=(0,l.useState)(0);(0,l.useEffect)(()=>{n||g||t.push("/login")},[n,t,g]),(0,l.useEffect)(()=>{(async()=>{if(n&&a)try{p(!0);let r=localStorage.getItem("token"),l=await fetch("http://localhost:8000/api/articles/".concat(e,"/"),{headers:{Authorization:"Bearer ".concat(r)}});if(!l.ok)throw Error("Error al cargar el art\xedculo: ".concat(l.status));let s=await l.json();if(u(s),s.author.id!==a.id)return void t.push("/articulos/".concat(e));let i=await fetch("http://localhost:8000/api/articles/".concat(e,"/images/"),{headers:{Authorization:"Bearer ".concat(r)}});if(i.ok){let e=await i.json();h(e.results||[])}x(null)}catch(e){console.error("Error:",e),x("Error al cargar los datos del art\xedculo.")}finally{p(!1)}})()},[e,n,a,t]);let P=async t=>{if(t.preventDefault(),!j||!d)return void x("Selecciona una imagen para subir");try{S(!0),I(0);let t=localStorage.getItem("token"),a=new FormData;a.append("image",j),a.append("caption",y),a.append("article",d.id.toString());let r=new XMLHttpRequest;r.upload.addEventListener("progress",e=>{if(e.lengthComputable){let t=Math.round(e.loaded/e.total*100);I(t)}}),r.onload=async()=>{if(r.status>=200&&r.status<300){v("Imagen subida correctamente"),N(""),w(null);let a=await fetch("http://localhost:8000/api/articles/".concat(e,"/images/"),{headers:{Authorization:"Bearer ".concat(t)}});if(a.ok){let e=await a.json();h(e.results||[])}setTimeout(()=>{v(null)},3e3)}else x("Error al subir la imagen: ".concat(r.status));S(!1)},r.onerror=()=>{x("Error de conexi\xf3n al subir la imagen"),S(!1)},r.open("POST","http://localhost:8000/api/articles/".concat(e,"/images/"),!0),r.setRequestHeader("Authorization","Bearer ".concat(t)),r.send(a)}catch(e){console.error("Error:",e),x("Error al subir la imagen"),S(!1)}},A=async t=>{if(confirm("\xbfEst\xe1s seguro de que quieres eliminar esta imagen?"))try{let a=localStorage.getItem("token");(await fetch("http://localhost:8000/api/articles/".concat(e,"/images/").concat(t,"/"),{method:"DELETE",headers:{Authorization:"Bearer ".concat(a)}})).ok?(h(m.filter(e=>e.id!==t)),v("Imagen eliminada correctamente"),setTimeout(()=>{v(null)},3e3)):x("Error al eliminar la imagen")}catch(e){console.error("Error:",e),x("Error al eliminar la imagen")}},C=async t=>{if(d)try{let a=localStorage.getItem("token"),r=await fetch("http://localhost:8000/api/articles/".concat(e,"/"),{method:"PATCH",headers:{Authorization:"Bearer ".concat(a),"Content-Type":"application/json"},body:JSON.stringify({image:t})});if(r.ok){let e=await r.json();u(e),v("Imagen principal actualizada"),setTimeout(()=>{v(null)},3e3)}else x("Error al establecer la imagen principal")}catch(e){console.error("Error:",e),x("Error al establecer la imagen principal")}};if(g)return(0,r.jsx)("div",{className:"flex justify-center items-center min-h-screen",children:(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-teal-500"})});if(!d)return(0,r.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,r.jsxs)("div",{className:"bg-red-50 p-4 rounded-lg text-red-700",children:["No se pudo cargar el art\xedculo. ",f]}),(0,r.jsx)(c(),{href:"/articulos",className:"mt-4 inline-block text-teal-600 hover:underline",children:"Volver a art\xedculos"})]});let z=e=>e.startsWith("http")?e:"http://localhost:8000".concat(e);return(0,r.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,r.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Gestionar im\xe1genes"}),(0,r.jsx)(c(),{href:"/articulos/".concat(e),className:"text-teal-600 hover:underline",children:"Volver al art\xedculo"})]}),f&&(0,r.jsx)("div",{className:"bg-red-50 p-4 rounded-lg text-red-700 mb-6",children:f}),b&&(0,r.jsx)("div",{className:"bg-green-50 p-4 rounded-lg text-green-700 mb-6",children:b}),(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6 mb-8",children:[(0,r.jsx)("h2",{className:"text-lg font-semibold mb-4",children:"Imagen principal"}),(0,r.jsx)("div",{className:"relative h-64 mb-4 bg-gray-100 rounded-lg overflow-hidden",children:d.image?(0,r.jsx)(o.default,{src:z(d.image),alt:d.title,fill:!0,sizes:"(max-width: 768px) 100vw, (max-width: 1200px) 50vw, 33vw",className:"object-cover"}):(0,r.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,r.jsx)("p",{className:"text-gray-500",children:"No hay imagen principal"})})})]}),(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6 mb-8",children:[(0,r.jsx)("h2",{className:"text-lg font-semibold mb-4",children:"Subir nueva imagen"}),(0,r.jsxs)("form",{onSubmit:P,className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-gray-700 text-sm font-medium mb-2",children:"Imagen"}),(0,r.jsx)("input",{type:"file",accept:"image/*",onChange:e=>{if(e.target.files&&e.target.files[0]){let t=e.target.files[0];if(!["image/jpeg","image/png","image/gif","image/webp"].includes(t.type))return void x("El archivo debe ser una imagen (JPEG, PNG, GIF o WEBP)");if(t.size>5242880)return void x("La imagen no puede superar los 5MB");w(t),x(null)}},className:"w-full p-2 border border-gray-300 rounded-lg"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-gray-700 text-sm font-medium mb-2",children:"Leyenda"}),(0,r.jsx)("input",{type:"text",value:y,onChange:e=>N(e.target.value),className:"w-full p-2 border border-gray-300 rounded-lg",placeholder:"Describe la imagen"})]}),E&&(0,r.jsxs)("div",{className:"w-full bg-gray-200 rounded-full h-2.5",children:[(0,r.jsx)("div",{className:"bg-teal-600 h-2.5 rounded-full",style:{width:"".concat(k,"%")}}),(0,r.jsxs)("p",{className:"text-sm text-gray-500 mt-1",children:[k,"% completado"]})]}),(0,r.jsx)("button",{type:"submit",disabled:E||!j,className:"w-full py-2 px-4 bg-teal-600 text-white rounded-lg hover:bg-teal-700 transition-colors\n                ".concat(E||!j?"opacity-50 cursor-not-allowed":""),children:E?"Subiendo...":"Subir imagen"})]})]}),(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6",children:[(0,r.jsx)("h2",{className:"text-lg font-semibold mb-4",children:"Im\xe1genes del art\xedculo"}),0===m.length?(0,r.jsx)("p",{className:"text-gray-500",children:"No hay im\xe1genes disponibles"}):(0,r.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:m.map(e=>(0,r.jsxs)("div",{className:"border rounded-lg overflow-hidden",children:[(0,r.jsx)("div",{className:"relative h-48",children:(0,r.jsx)(o.default,{src:z(e.image),alt:e.caption||"Imagen del art\xedculo",fill:!0,sizes:"(max-width: 768px) 100vw, (max-width: 1200px) 50vw, 33vw",className:"object-cover"})}),(0,r.jsxs)("div",{className:"p-3",children:[(0,r.jsx)("p",{className:"text-sm text-gray-700 mb-2",children:e.caption||"Sin descripci\xf3n"}),(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("button",{onClick:()=>C(e.image),className:"text-sm text-teal-600 hover:underline",disabled:d.image===e.image,children:d.image===e.image?"Imagen principal":"Establecer como principal"}),(0,r.jsx)("button",{onClick:()=>A(e.id),className:"text-sm text-red-600 hover:underline",children:"Eliminar"})]})]})]},e.id))})]})]})})}},5695:(e,t,a)=>{"use strict";var r=a(8999);a.o(r,"useParams")&&a.d(t,{useParams:function(){return r.useParams}}),a.o(r,"usePathname")&&a.d(t,{usePathname:function(){return r.usePathname}}),a.o(r,"useRouter")&&a.d(t,{useRouter:function(){return r.useRouter}})},5731:(e,t,a)=>{"use strict";a.d(t,{A:()=>o,default:()=>n});var r=a(5155),l=a(2115),s=a(5695);let i=(0,l.createContext)(void 0),o=()=>{let e=(0,l.useContext)(i);if(void 0===e)throw Error("useAuth debe ser usado dentro de un AuthProvider");return e};function n(e){let{children:t}=e,[a,o]=(0,l.useState)(null),[n,c]=(0,l.useState)(null),[d,u]=(0,l.useState)(!0),[m,h]=(0,l.useState)(null),g=(0,s.useRouter)();(0,l.useEffect)(()=>{(async()=>{try{let e=localStorage.getItem("token");if(e){c(e);let t=await fetch("http://localhost:8000/api/users/profile/",{headers:{Authorization:"Bearer ".concat(e)}});if(t.ok){let e=await t.json();o(e)}else localStorage.removeItem("token"),c(null),o(null)}}catch(e){console.error("Error verificando sesi\xf3n:",e)}finally{u(!1)}})()},[]);let p=async(e,t)=>{u(!0),h(null);try{let a=await fetch("http://localhost:8000/api/token/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t})});if(a.ok){let e=await a.json();localStorage.setItem("token",e.access),localStorage.setItem("refresh_token",e.refresh),c(e.access);let t=await fetch("http://localhost:8000/api/users/profile/",{headers:{Authorization:"Bearer ".concat(e.access)}});if(t.ok){let e=await t.json();return o(e),!0}}else{let e=await a.json();return h(e.detail||"Error al iniciar sesi\xf3n"),!1}}catch(e){h("Error de conexi\xf3n"),console.error(e)}finally{u(!1)}return!1},f=async(e,t,a,r)=>{u(!0),h(null);try{let i={email:e,password:t,...a&&{first_name:a},...r&&{last_name:r}},o=await fetch("http://localhost:8000/api/users/register/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(o.ok)return await p(e,t);{var l,s;let e=await o.json();return h((null==(l=e.email)?void 0:l[0])||(null==(s=e.password)?void 0:s[0])||"Error al registrarse"),!1}}catch(e){return h("Error de conexi\xf3n"),console.error(e),!1}finally{u(!1)}};return(0,r.jsx)(i.Provider,{value:{user:a,token:n,login:p,register:f,logout:()=>{localStorage.removeItem("token"),localStorage.removeItem("refresh_token"),c(null),o(null),g.push("/")},isAuthenticated:!!a&&!!n,isLoading:d,error:m},children:t})}},7681:(e,t,a)=>{Promise.resolve().then(a.bind(a,1284))}},e=>{var t=t=>e(e.s=t);e.O(0,[874,766,441,684,358],()=>t(7681)),_N_E=e.O()}]);