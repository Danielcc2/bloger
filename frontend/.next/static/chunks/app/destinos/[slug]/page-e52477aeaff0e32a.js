(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[206],{4101:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>m});var s=r(5155),a=r(2115),l=r(6766),o=r(6874),i=r.n(o),n=r(5695),c=r(5731);let d=["http://localhost:8000","http://127.0.0.1:8000","http://0.0.0.0:8000","http://192.168.1.33:8000"];function m(){let e=(0,n.useParams)(),t=(0,n.useRouter)(),{user:r,token:o}=(0,c.A)(),m=Array.isArray(null==e?void 0:e.slug)?e.slug[0]:null==e?void 0:e.slug,[u,h]=(0,a.useState)(null),[x,p]=(0,a.useState)(!0),[f,g]=(0,a.useState)(null),[v,w]=(0,a.useState)(null),[j,N]=(0,a.useState)(!1),[b,y]=(0,a.useState)([]);(0,a.useEffect)(()=>{if(!m){g("No se proporcion\xf3 un destino v\xe1lido"),p(!1);return}(async()=>{for(let e of(p(!0),d))try{let t="".concat(e,"/api/destinations/").concat(m),r=await fetch(t,{method:"GET",headers:{Accept:"application/json"},mode:"cors",cache:"no-store"});if(r.ok){let t=await r.json();h(t),w(e),g(null),p(!1);return}404===r.status?g("El destino solicitado no existe"):console.error("Error en ".concat(e,": ").concat(r.status))}catch(t){console.error("Error conectando a ".concat(e,":"),t)}g("No se pudo cargar el destino desde el servidor"),p(!1)})()},[m]),(0,a.useEffect)(()=>{(async()=>{if(r&&o&&v)try{let e=await fetch("".concat(v,"/api/users/permissions/"),{headers:{Authorization:"Bearer ".concat(o)}});if(e.ok){let t=await e.json();N(t.is_admin),console.log("Estado de administrador:",t.is_admin)}}catch(e){console.error("Error al verificar el estado de administrador:",e)}})()},[r,o,v]),(0,a.useEffect)(()=>{u&&v&&(async()=>{try{let e=u.country||u.city||u.name,t=await fetch("".concat(v,"/api/articles/?search=").concat(encodeURIComponent(e),"&limit=4"));if(t.ok){let e=await t.json();y(e.results||[])}}catch(e){console.error("Error al cargar art\xedculos relacionados:",e)}})()},[u,v]);let E=async()=>{if(!r){g("Debes iniciar sesi\xf3n para eliminar un destino"),t.push("/login");return}try{let e=await fetch("".concat(v,"/api/users/permissions/"),{headers:{Authorization:"Bearer ".concat(o)}});if(e.ok){let t=await e.json();if(console.log("Datos de permisos:",t),!t.is_admin)return void g("No tienes permisos para eliminar destinos")}else{console.error("Error al verificar permisos:",e.status),g("Error al verificar tus permisos");return}}catch(e){console.error("Error al comprobar permisos:",e),g("Error al verificar tus permisos de administrador");return}if(window.confirm("\xbfEst\xe1s seguro de que quieres eliminar este destino? Esta acci\xf3n no se puede deshacer."))try{let e=localStorage.getItem("token");if(!e)return void t.push("/login");let r="".concat(v,"/api/destinations/").concat(null==u?void 0:u.slug,"/delete/");console.log("Intentando eliminar destino con URL:",r),console.log("Token encontrado:",e?"S\xed":"No"),console.log("Destino a eliminar:",u);let s=await fetch(r,{method:"DELETE",headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"}});if(console.log("Respuesta del servidor:",s.status,s.statusText),s.ok)console.log("Destino eliminado correctamente"),t.push("/destinos");else{let e="No se pudo eliminar el destino";try{let t=await s.text();if(console.error("Respuesta de error completa:",t),t)try{let r=JSON.parse(t);e=r.detail||r.message||e}catch(r){console.error("Error parsing error response:",r),t.length<100&&(e=t)}}catch(e){console.error("Error al leer la respuesta:",e)}throw 403===s.status?e="No tienes permisos para eliminar este destino":404===s.status&&(e="El destino no existe o ya ha sido eliminado"),Error(e)}}catch(e){console.error("Error al eliminar:",e),e instanceof Error?g("Error al eliminar el destino: ".concat(e.message)):g("Error desconocido al eliminar el destino")}};if(x)return(0,s.jsxs)("div",{className:"flex justify-center items-center min-h-screen",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-teal-500"}),(0,s.jsx)("p",{className:"ml-3 text-gray-600",children:"Cargando destino..."})]});if(f||!u)return(0,s.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,s.jsxs)("div",{className:"max-w-4xl mx-auto bg-red-50 p-6 rounded-lg",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold text-red-700 mb-4",children:"Error"}),(0,s.jsx)("p",{className:"text-gray-700 mb-4",children:f||"No se encontr\xf3 el destino solicitado"}),(0,s.jsx)(i(),{href:"/destinos",className:"inline-block px-6 py-2 bg-teal-600 text-white rounded-lg hover:bg-teal-700 transition-colors",children:"Volver a destinos"})]})});let S=e=>new Date(e).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric"}),k=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,r=e.replace(/<[^>]*>/g,"");return r.length>t?r.substring(0,t)+"...":r};return(0,s.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,s.jsxs)("div",{className:"max-w-4xl mx-auto",children:[f&&(0,s.jsx)("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg text-red-700",children:(0,s.jsxs)("p",{className:"flex items-center",children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-2",viewBox:"0 0 20 20",fill:"currentColor",children:(0,s.jsx)("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),f]})}),(0,s.jsxs)("div",{className:"mb-8",children:[(0,s.jsxs)(i(),{href:"/destinos",className:"inline-flex items-center text-teal-600 hover:text-teal-800",children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-1",viewBox:"0 0 20 20",fill:"currentColor",children:(0,s.jsx)("path",{fillRule:"evenodd",d:"M9.707 14.707a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 1.414L7.414 9H15a1 1 0 110 2H7.414l2.293 2.293a1 1 0 010 1.414z",clipRule:"evenodd"})}),"Volver a destinos"]}),j&&(0,s.jsx)("span",{className:"ml-4 bg-purple-100 text-purple-800 text-xs font-medium px-2.5 py-0.5 rounded",children:"Modo Administrador"})]}),(0,s.jsxs)("div",{className:"mb-8 flex justify-between items-center",children:[(0,s.jsx)("h1",{className:"text-4xl font-bold mb-4 text-gray-800",children:u.name}),j&&(0,s.jsxs)("button",{onClick:E,className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors font-bold text-md shadow-md flex items-center",children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-2",viewBox:"0 0 20 20",fill:"currentColor",children:(0,s.jsx)("path",{fillRule:"evenodd",d:"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z",clipRule:"evenodd"})}),"Eliminar"]})]}),(0,s.jsxs)("div",{className:"flex flex-wrap items-center text-gray-600 mb-6 gap-4",children:[(0,s.jsx)("span",{className:"bg-teal-50 text-teal-700 px-3 py-1 rounded-full text-sm",children:u.country}),(0,s.jsx)("span",{className:"text-sm",children:u.city})]}),(0,s.jsx)("div",{className:"mb-8 rounded-lg overflow-hidden h-96 relative",children:(0,s.jsx)(l.default,{src:u.image?u.image.startsWith("http")?u.image:"".concat(v).concat(u.image):"/images/destinos/placeholder.jpg",alt:u.name,fill:!0,sizes:"(max-width: 768px) 100vw, (max-width: 1200px) 100vw, 800px",style:{objectFit:"cover"},className:"transition-transform hover:scale-105 duration-500",priority:!0})}),(0,s.jsx)("div",{className:"prose lg:prose-xl max-w-none mb-12",dangerouslySetInnerHTML:{__html:u.description}}),b.length>0&&(0,s.jsxs)("div",{className:"my-16",children:[(0,s.jsxs)("h2",{className:"text-3xl font-bold mb-8 text-gray-800 flex items-center",children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-8 w-8 mr-3 text-teal-600",viewBox:"0 0 20 20",fill:"currentColor",children:(0,s.jsx)("path",{d:"M7 3a1 1 0 000 2h6a1 1 0 100-2H7zM4 7a1 1 0 011-1h10a1 1 0 110 2H5a1 1 0 01-1-1zM2 11a2 2 0 012-2h12a2 2 0 012 2v4a2 2 0 01-2 2H4a2 2 0 01-2-2v-4z"})}),"Art\xedculos sobre ",u.name]}),(0,s.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:b.map(e=>{var t,r;return(0,s.jsxs)("div",{className:"bg-white rounded-lg overflow-hidden shadow-md hover:shadow-lg transition-all duration-300 flex flex-col transform hover:-translate-y-1",children:[(0,s.jsxs)("div",{className:"relative h-48",children:[e.image?(0,s.jsx)(l.default,{src:e.image.startsWith("http")?e.image:e.image.startsWith("/media/")?"".concat(v).concat(e.image):"".concat(v,"/media/").concat(e.image),alt:e.title,fill:!0,sizes:"(max-width: 768px) 100vw, (max-width: 1200px) 50vw, 33vw",className:"object-cover",onError:()=>{let t=document.querySelector("img[alt='".concat(e.title,"']"));t&&(t.src="/images/destinos/default.jpg")}}):(0,s.jsx)("div",{className:"absolute inset-0 bg-gradient-to-r from-teal-500 to-blue-500 flex items-center justify-center",children:(0,s.jsx)("span",{className:"text-4xl text-white font-bold",children:e.title.charAt(0)})}),(0,s.jsx)("div",{className:"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/70 to-transparent text-white p-4",children:(0,s.jsx)("p",{className:"text-sm font-medium",children:S(e.created_at)})})]}),(0,s.jsxs)("div",{className:"p-5 flex-grow flex flex-col",children:[(0,s.jsx)("h3",{className:"text-xl font-bold mb-2 line-clamp-2 text-gray-800",children:(0,s.jsx)(i(),{href:"/articulos/".concat(e.slug),className:"hover:text-teal-600 transition-colors",children:e.title})}),(0,s.jsx)("p",{className:"text-gray-600 mb-4 line-clamp-3 flex-grow",children:k(e.content,120)}),(0,s.jsxs)("div",{className:"flex justify-between items-center mt-auto pt-4 border-t border-gray-100",children:[(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("div",{className:"w-8 h-8 rounded-full bg-teal-100 flex items-center justify-center text-teal-800 font-bold mr-2",children:(null==(t=e.author.first_name)?void 0:t.charAt(0))||(null==(r=e.author.email)?void 0:r.charAt(0))}),(0,s.jsx)("span",{className:"text-sm text-gray-700",children:e.author.first_name||e.author.email.split("@")[0]})]}),(0,s.jsxs)(i(),{href:"/articulos/".concat(e.slug),className:"inline-flex items-center text-teal-600 hover:text-teal-800 font-medium text-sm",children:["Leer art\xedculo",(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 ml-1",viewBox:"0 0 20 20",fill:"currentColor",children:(0,s.jsx)("path",{fillRule:"evenodd",d:"M10.293 5.293a1 1 0 011.414 0l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414-1.414L12.586 11H5a1 1 0 110-2h7.586l-2.293-2.293a1 1 0 010-1.414z",clipRule:"evenodd"})})]})]})]})]},e.id)})})]}),(0,s.jsx)("div",{className:"mt-12 border-t pt-8",children:(0,s.jsxs)("div",{className:"flex flex-wrap gap-4 justify-between",children:[(0,s.jsxs)(i(),{href:"/destinos",className:"inline-flex items-center text-teal-600 hover:text-teal-800",children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-1",viewBox:"0 0 20 20",fill:"currentColor",children:(0,s.jsx)("path",{fillRule:"evenodd",d:"M9.707 14.707a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 1.414L7.414 9H15a1 1 0 110 2H7.414l2.293 2.293a1 1 0 010 1.414z",clipRule:"evenodd"})}),"Ver todos los destinos"]}),(0,s.jsxs)("a",{href:"#",className:"inline-flex items-center text-teal-600 hover:text-teal-800",onClick:e=>{e.preventDefault(),window.scrollTo({top:0,behavior:"smooth"})},children:[(0,s.jsx)("span",{className:"mr-1",children:"Volver arriba"}),(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:(0,s.jsx)("path",{fillRule:"evenodd",d:"M14.707 12.707a1 1 0 01-1.414 0L10 9.414l-3.293 3.293a1 1 0 01-1.414-1.414l4-4a1 1 0 011.414 0l4 4a1 1 0 010 1.414z",clipRule:"evenodd"})})]})]})})]})})}},5695:(e,t,r)=>{"use strict";var s=r(8999);r.o(s,"useParams")&&r.d(t,{useParams:function(){return s.useParams}}),r.o(s,"usePathname")&&r.d(t,{usePathname:function(){return s.usePathname}}),r.o(s,"useRouter")&&r.d(t,{useRouter:function(){return s.useRouter}})},5731:(e,t,r)=>{"use strict";r.d(t,{A:()=>i,default:()=>n});var s=r(5155),a=r(2115),l=r(5695);let o=(0,a.createContext)(void 0),i=()=>{let e=(0,a.useContext)(o);if(void 0===e)throw Error("useAuth debe ser usado dentro de un AuthProvider");return e};function n(e){let{children:t}=e,[r,i]=(0,a.useState)(null),[n,c]=(0,a.useState)(null),[d,m]=(0,a.useState)(!0),[u,h]=(0,a.useState)(null),x=(0,l.useRouter)();(0,a.useEffect)(()=>{(async()=>{try{let e=localStorage.getItem("token");if(e){c(e);let t=await fetch("http://localhost:8000/api/users/profile/",{headers:{Authorization:"Bearer ".concat(e)}});if(t.ok){let e=await t.json();i(e)}else localStorage.removeItem("token"),c(null),i(null)}}catch(e){console.error("Error verificando sesi\xf3n:",e)}finally{m(!1)}})()},[]);let p=async(e,t)=>{m(!0),h(null);try{let r=await fetch("http://localhost:8000/api/token/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t})});if(r.ok){let e=await r.json();localStorage.setItem("token",e.access),localStorage.setItem("refresh_token",e.refresh),c(e.access);let t=await fetch("http://localhost:8000/api/users/profile/",{headers:{Authorization:"Bearer ".concat(e.access)}});if(t.ok){let e=await t.json();return i(e),!0}}else{let e=await r.json();return h(e.detail||"Error al iniciar sesi\xf3n"),!1}}catch(e){h("Error de conexi\xf3n"),console.error(e)}finally{m(!1)}return!1},f=async(e,t,r,s)=>{m(!0),h(null);try{let o={email:e,password:t,...r&&{first_name:r},...s&&{last_name:s}},i=await fetch("http://localhost:8000/api/users/register/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});if(i.ok)return await p(e,t);{var a,l;let e=await i.json();return h((null==(a=e.email)?void 0:a[0])||(null==(l=e.password)?void 0:l[0])||"Error al registrarse"),!1}}catch(e){return h("Error de conexi\xf3n"),console.error(e),!1}finally{m(!1)}};return(0,s.jsx)(o.Provider,{value:{user:r,token:n,login:p,register:f,logout:()=>{localStorage.removeItem("token"),localStorage.removeItem("refresh_token"),c(null),i(null),x.push("/")},isAuthenticated:!!r&&!!n,isLoading:d,error:u},children:t})}},6810:(e,t,r)=>{Promise.resolve().then(r.bind(r,4101))}},e=>{var t=t=>e(e.s=t);e.O(0,[874,766,441,684,358],()=>t(6810)),_N_E=e.O()}]);